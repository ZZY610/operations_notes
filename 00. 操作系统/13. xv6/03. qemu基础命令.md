# 03. qemuåŸºç¡€å‘½ä»¤
## **QEMU çš„åŸºç¡€ä½¿ç”¨æ–¹æ³•ï¼ˆLinux å¹³å°ï¼‰**

### **1. ä»€ä¹ˆæ˜¯ QEMUï¼Ÿ**
**QEMUï¼ˆQuick Emulatorï¼‰** æ˜¯ä¸€ä¸ªå¼€æºçš„è™šæ‹ŸåŒ–å·¥å…·ï¼Œå¯ä»¥æ¨¡æ‹Ÿå„ç§ CPU æ¶æ„ï¼Œå¹¶è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚å®ƒå¯ä»¥ç”¨æ¥ï¼š
- **è™šæ‹Ÿæœºè¿è¡Œ**ï¼ˆç±»ä¼¼äº VirtualBoxã€VMwareï¼‰
- **æ“ä½œç³»ç»Ÿå¼€å‘**ï¼ˆè°ƒè¯•å†…æ ¸ã€ç¼–å†™ Bootloaderï¼‰
- **æ¨¡æ‹Ÿä¸åŒ CPU**ï¼ˆARMã€RISC-Vã€MIPS ç­‰ï¼‰

QEMU ä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼ï¼š
1. **å…¨ç³»ç»Ÿä»¿çœŸï¼ˆSystem Emulationï¼‰**ï¼šæ¨¡æ‹Ÿå®Œæ•´çš„è®¡ç®—æœºï¼Œä¾‹å¦‚ `qemu-system-x86_64`
2. **ç”¨æˆ·æ¨¡å¼ä»¿çœŸï¼ˆUser Mode Emulationï¼‰**ï¼šè¿è¡Œä¸åŒæ¶æ„çš„åº”ç”¨ï¼Œä¾‹å¦‚ `qemu-arm` è¿è¡Œ ARM ç¨‹åº

---

## **2. å®‰è£… QEMU**
åœ¨ Ubuntu ä¸Šå®‰è£…ï¼š
```sh
sudo apt update
sudo apt install -y qemu qemu-system-x86
```
éªŒè¯å®‰è£…ï¼š
```sh
qemu-system-x86_64 --version
```

---

## **3. åŸºç¡€ QEMU å‘½ä»¤**

### **ï¼ˆ1ï¼‰è¿è¡Œä¸€ä¸ª ISO é•œåƒ**
```sh
qemu-system-x86_64 -cdrom ubuntu.iso
```
- `-cdrom ubuntu.iso`ï¼šä» ISO å¯åŠ¨ç³»ç»Ÿ

âš¡ **ç¤ºä¾‹**ï¼šä¸‹è½½ **Tiny Core Linux**ï¼Œç„¶åè¿è¡Œï¼š
```sh
wget http://tinycorelinux.net/14.x/x86/release/TinyCore-current.iso
qemu-system-x86_64 -cdrom TinyCore-current.iso -m 512M
```
- `-m 512M`ï¼šåˆ†é… 512MB å†…å­˜

---

### **ï¼ˆ2ï¼‰åˆ›å»ºå¹¶ä½¿ç”¨è™šæ‹Ÿç£ç›˜**
**â‘  åˆ›å»º 10GB çš„ç£ç›˜**
```sh
qemu-img create -f qcow2 mydisk.qcow2 10G
```
- `-f qcow2`ï¼šä½¿ç”¨ QCOW2 æ ¼å¼ï¼ˆèŠ‚çœç©ºé—´ï¼‰

**â‘¡ è¿è¡Œæ—¶æŒ‚è½½è™šæ‹Ÿç£ç›˜**
```sh
qemu-system-x86_64 -hda mydisk.qcow2 -cdrom ubuntu.iso -boot d -m 1024
```
- `-hda mydisk.qcow2`ï¼šä½¿ç”¨ `mydisk.qcow2` ä½œä¸ºç¡¬ç›˜
- `-boot d`ï¼šä»å…‰ç›˜å¯åŠ¨
- `-m 1024`ï¼šåˆ†é… 1GB å†…å­˜

---

### **ï¼ˆ3ï¼‰è¿è¡Œä¸€ä¸ª Linux å†…æ ¸**
```sh
qemu-system-x86_64 -kernel bzImage -initrd initrd.img -append "console=ttyS0" -nographic
```
- `-kernel bzImage`ï¼šåŠ è½½ Linux å†…æ ¸
- `-initrd initrd.img`ï¼šä½¿ç”¨ `initrd` ä½œä¸ºä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ
- `-append "console=ttyS0"`ï¼šé‡å®šå‘ç»ˆç«¯åˆ° `ttyS0`
- `-nographic`ï¼šä¸ä½¿ç”¨å›¾å½¢ç•Œé¢ï¼Œå…¨éƒ¨è¾“å‡ºåˆ°ç»ˆç«¯

---

### **ï¼ˆ4ï¼‰ç½‘ç»œæ”¯æŒ**
```sh
qemu-system-x86_64 -netdev user,id=mynet -device e1000,netdev=mynet -hda mydisk.qcow2
```
- `-netdev user,id=mynet`ï¼šå¯ç”¨ç”¨æˆ·ç½‘ç»œ
- `-device e1000,netdev=mynet`ï¼šä½¿ç”¨ Intel e1000 ç½‘å¡

---

### **ï¼ˆ5ï¼‰æŒ‚è½½ä¸€ä¸ª ISO é•œåƒï¼Œå¹¶è®©è™šæ‹Ÿæœºå¯åŠ¨åˆ° BIOS**
```sh
qemu-system-x86_64 -hda mydisk.qcow2 -cdrom ubuntu.iso -boot menu=on
```
- `-boot menu=on`ï¼šå¯ç”¨å¯åŠ¨èœå•

---

## **4. äº¤äº’æ“ä½œ**
**QEMU åœ¨è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®ï¼š**
- `Ctrl + Alt + 2`ï¼šè¿›å…¥ QEMU Monitor
- `Ctrl + Alt + 1`ï¼šè¿”å›è™šæ‹Ÿæœº
- `Ctrl + Alt + F`ï¼šåˆ‡æ¢å…¨å±
- `Ctrl + Alt + G`ï¼šè§£é”é¼ æ ‡

**ç¤ºä¾‹ï¼šåœ¨ Monitor æ¨¡å¼ä¸‹è¾“å…¥ `quit` é€€å‡º**
```sh
(qemu) quit
```

---

## **5. é€€å‡º QEMU**
æ–¹å¼ï¼š
1. `Ctrl + C`
2. åœ¨ Monitor ç•Œé¢è¾“å…¥ `quit`
3. å¦‚æœæ˜¯ `-nographic` æ¨¡å¼ï¼ŒæŒ‰ `Ctrl + A`ï¼Œç„¶å `X`

---

## **6. æ€»ç»“**
| åŠŸèƒ½ | å‘½ä»¤ |
|------|------|
| è¿è¡Œ ISO | `qemu-system-x86_64 -cdrom file.iso` |
| åˆ›å»ºç£ç›˜ | `qemu-img create -f qcow2 disk.qcow2 10G` |
| æŒ‚è½½ç£ç›˜ | `qemu-system-x86_64 -hda disk.qcow2` |
| è¿è¡Œ Linux å†…æ ¸ | `qemu-system-x86_64 -kernel bzImage -initrd initrd.img -append "console=ttyS0"` |
| å¯ç”¨ç½‘ç»œ | `qemu-system-x86_64 -netdev user,id=mynet -device e1000,netdev=mynet` |
| è¿›å…¥ BIOS | `qemu-system-x86_64 -hda disk.qcow2 -boot menu=on` |

QEMU æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è™šæ‹ŸåŒ–å·¥å…·ï¼ŒæŒæ¡å®ƒåä½ å¯ä»¥è¿›è¡Œ **æ“ä½œç³»ç»Ÿå¼€å‘ã€å†…æ ¸è°ƒè¯•ã€æ¶æ„æ¨¡æ‹Ÿç­‰**ã€‚å¦‚æœä½ æƒ³æ·±å…¥å­¦ä¹ ï¼Œå¯ä»¥å°è¯•ç¼–å†™ä¸€ä¸ª **è‡ªåˆ¶ OS** å¹¶è¿è¡Œå®ƒï¼ğŸš€