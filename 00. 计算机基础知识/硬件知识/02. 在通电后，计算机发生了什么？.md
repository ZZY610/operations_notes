# 03. 在通电后，计算机发生了什么？

## 1. 通电，CPU初始化

- 计算机接通电源后，**电源管理芯片**(Power Management Unit, PMU)检测到稳定电压。
- **CPU开始复位(Reset)**：
  - 将自己置于一个“初始状态”，比如：
    - 指令指针（IP）指向固定的内存地址（通常是0xFFFF0附近）。
    - CPU寄存器清空或初始化。
    - 默认进入实模式(Real Mode)（在x86早期体系里）。

---

## 2. BIOS/UEFI 启动

- CPU从固定地址读取**BIOS/UEFI固件**的程序。
- BIOS/UEFI是**保存在主板ROM芯片**（只读存储器）中的小型操作程序。

  BIOS/UEFI负责：
  - 初始化基本硬件（内存、显卡、硬盘、USB等）。
  - 执行**POST（Power On Self Test）**，检测硬件是否正常。
  - 提供一个最小的输入输出功能，比如读键盘、显示启动画面。

---

## 3. 找到引导设备

- BIOS/UEFI根据设定的**启动顺序**（比如硬盘、U盘、光盘）查找有效的**引导扇区（Boot Sector）**。
- 找到后，加载第一个扇区（通常是MBR或者ESP分区），并把**控制权交给引导程序（Bootloader）**。

---

## 4. Bootloader（引导程序）阶段

常见的引导程序有：
- GRUB（Linux常见）
- Windows Boot Manager（Windows）
- rEFInd（多系统引导）

Bootloader作用：
- 显示启动菜单（比如让你选择进入Windows还是Linux）。
- 加载操作系统的核心文件（**内核映像文件**，比如`vmlinuz`、`ntoskrnl.exe`）。
- 将内核文件解压到内存中。
- 把控制权交给内核。

---

## 5. 内核（Kernel）初始化

- **操作系统内核**开始执行！
- 进入保护模式（Protected Mode），或长模式（Long Mode，64位）。
- 内核完成一系列初始化动作：
  - 建立内存管理机制（分页，虚拟内存）。
  - 初始化各种硬件驱动程序（网卡、显卡、声卡、磁盘、USB等）。
  - 设置中断处理程序（Interrupt Handler）。
  - 启动系统任务调度器（Scheduler）。

此时，操作系统就掌握了**对整个计算机的控制权**。

---

## 6. 启动用户空间（User Space）

- **操作系统启动第一个用户进程**：
  - Windows会启动`wininit.exe`。
  - Linux会启动`systemd`或`init`。
- 这些进程负责启动更多的系统服务（daemon、service）。
- 最终，启动桌面环境或命令行界面，用户可以开始交互。

---

## 7. 用户登录并运行程序

- 用户输入用户名密码登录系统。
- 桌面环境（如Windows桌面、GNOME、KDE）启动。
- 用户打开应用程序（比如浏览器、编辑器、游戏）。

此时，普通应用程序：
- 运行在**用户态**。
- 通过**系统调用**请求操作系统服务。
- 无法直接控制硬件，所有动作都要通过操作系统。

---

# 🖥 整个流程总结一句话：

> "**通电后 → 固件初始化 → 加载引导程序 → 启动操作系统内核 → 初始化硬件 → 启动用户进程 → 用户交互**"

---

# 🎯 补充：你的理解 — “计算机只有状态，操作系统操纵状态”？

✅ 很接近本质。  
更准确地说：
- 计算机本质上是一台状态机（State Machine），有CPU寄存器、内存单元、IO设备状态。
- 操作系统是**最核心的程序**，它在运行时不断地修改这些状态，以调度资源、执行程序、管理输入输出。
- 其他用户程序，只能通过操作系统来**间接影响计算机的状态**。

---

# 🧩 可视化流程图


```
[通电] 
   ↓
[BIOS/UEFI启动] 
   ↓
[POST自检，初始化硬件] 
   ↓
[寻找Bootloader]
   ↓
[加载Bootloader] 
   ↓
[加载操作系统内核] 
   ↓
[内核初始化硬件资源]
   ↓
[启动第一个用户进程]
   ↓
[加载桌面环境/终端]
   ↓
[等待用户登录与交互]
```
