# 关系数据模型
::: tip 关系模型的特点

（1）关系模型建立在严格的数学理论基础之上。
（2）数据结构简单清晰，用户易懂易用。关系模型的数据结构虽然简单，但却能表达丰富的语义，能够较好地描述现实世界的实体以及实体间的各种联系。
（3）数据物理存取路径对用户是透明的，有更高的数据独立性、更好的数据安全性。

:::

## 1. 关系数据结构
### 1.1 二维表与关系数据结构 
![Img](./FILES/02.%20关系数据模型.md/img-20230307100207.png)
* 二维表的特点
（1）每个表具有表名
（2）表由表头和若干行数据两部分构成
（3）表有若干列，每列都有列名
（4）同一列的值必须取自 **同一个域**
（5）每一行的数据代表一个实体的信息

* 一个关系就是一个规范化的二维表。
* “规范化”的含义是：表中每列都是原子项，即没有“表中表”。  
* 一个关系由==关系名==、==关系模式==和==关系实例==组成。通常，它们分别对应于二维表的表名、表头和数据。

#### 术语
* <span style="color:red">关系</span>：一个关系（Relation）指一张二维表。
* <span style="color:red">元组</span>：一个元组（Tuple）指二维表中的一行。
* <span style="color:red">属性</span>：一个属性（Attribute）指二维表中的一列，表中每列均有名称，即属性名。
* <span style="color:red">码</span>（key）：也称键、关键字、关键码，指表中可唯一确定元组的属性或属性组合。
* <span style="color:red">域</span>（Domain）：指属性的取值范围。
* 分量：指元组中的一个属性值。
* <span style="color: rgb(255, 41, 65);">关系模式</span>：是对关系“型”的描述，通常表示为：
$关系名(属性1，属性2，…，属性n)$
![Img](./FILES/02.%20关系数据模型.md/img-20230307101230.png)

### 1.2 关系数据结构的形式化定义 

### 1.3 关系的性质
（1）列是同质的（Homogeneous），即每列中的分量必须是同一类型的数据。
（2）不同的列可以出自同一个域，但不同的属性必须赋予不同的属性名。
（3）列的顺序可以任意交换。交换时，应连同属性名一起交换。
（4）任意两个元组不能完全相同。
（5）关系中元组的顺序可任意，即可任意交换两行的次序。
（6）分量必须取原子值，即要求每个分量都是不可再分的数据项。

### 1.4 关系模式
* 关系模式（Relation Schema）是型
* 关系是值
* 关系模式是对关系的描述
    * 元组集合的结构
    * 元组语义以及完整性约束条件
    * 属性间的数据依赖关系集合     

#### 定义关系模式
::: tip 定义关系模式
关系模式可形式化地表示为：
$$R（U，D，dom，F）$$

* R ：     关系名
* U ：      组成该关系的属性名集合
* D ：      属性组U中属性所来自的域
* dom ：  属性向域的映象集合
* F ：       属性间的数据依赖关系集合

关系模式通常可简记为
$$ 	R (U)    或    R (A1，A2，…，An)$$
* R： 关系名
* A1，A2，…，An：      属性名
注：域名及属性向域的映象常常直接说明为属性的类型、长度
:::


### 1.5 关系数据库
#### 定义
* 在一个给定的应用领域中，所有实体及实体之间联系的关系的集合构成一个关系数据库。
    * 例如，在研究商品订购管理的问题域中，商品（GoodsInfo）、客户（CustomerInfo）、商品订购（OrderList）这三个关系的集合就构成商品订购数据库。 
#### 关系数据库的型和值
关系数据库也有型和值之分
* 关系数据库的型 称为关系数据库模式，是对关系数据库的描述.

* 关系数据库的值 是这些关系模式在某一时刻对应的关系的集合，通常简称为关系数据库.
#### 空值
* 在关系元组中允许出现空值。
* 空值表示信息的空缺。空值表示未知的值或不存在值。
    * 例如，GoodsOrder关系中，某个商品没有备注信息，则该商品元组的“备注”分量值即为空值。空值一般用关键词NULL表示。 

### 1.6 码

#### 候选码(Candidate key)
设关系 $R(A_1，A_2，…，A_n)$ ，其属性为 $A_1，A_2，…，A_n$ ，属性集 $K$ 为 $R$ 的子集， $K=(A_i，A_j，…，A_k)，1≤i，j，…，k≤n$ 。当且仅当满足下列两个条件时， K 被称为候选码：
* 唯一性。对关系 R 的任两个元组，其在属性集 $K$ 上的值是不同的。
* 最小性。属性集 $K=(A_i，A_j，…，A_k)$ 是最小集，即若删除K中的任一属性，K都不满足最小性。 

#### 主码、主属性、非主属性
* 若一个关系有多个候选码，则选定其中一个为主码（Primary key）

* 包含于候选码的属性称为主属性（Prime attribute）。

* 不包含在任何侯选码中的属性称为非主属性（Non-key attribute）

#### 外码
* 如果关系R1的属性或属性组K不是R1的主码，而是另一关系R2的主码，则称K为关系R1的外码（Foreign Key）.
* 并称关系R1为参照关系（Referencing Relation）
* 关系R2为被参照关系（Referenced Relation）

## 2. 关系代数
一种抽象的查询语言。用对关系的运算来表达查询。
* 关系代数表达式的三个要素
    * 运算对象：关系
    * 运算结果：关系
    * 运算符： (集合、专门关系代数、比较、逻辑)

| 运算符 | 记号 | 含义 |
| -- | -- | -- |
| 集合运算符{rowspan=4} | ∪ | 并 |
| — | 差 |
| ∩ | 交 |
| × | 笛卡尔积 |
| 专门的关系运算符{rowspan=4} | σ | 选择 |
| Π | 投影 |
| ⨝ | 连接 |
| ÷ | 除法 |
| 比较运算符{rowspan=6} | < | 小于 |
| ≤ | 小于等于 |
| > | 大于 |
| ≥ | 大于等于 |
| = | 等于 | 
| <> | 不等于 | 
| 逻辑运算符{rowspan=3} | ┐ | 非 |
| ∧ | 与 |
| ∨ | 或 |




## 3. 关系完整性
* 关系模型的完整性规则是对关系的某种约束条件。
* 关系模型中三类完整性约束：
    * 实体完整性
    * 参照完整性
    * 用户定义的完整性
* 实体完整性和参照完整性是关系模型必须满足的完整性约束条件，被称作是关系的两个不变性，应该由关系系统自动支持。
### 1. 实体完整性 ( *Entity Integrity* )
* 若属性A是基本关系R的主属性，则属性A不能取空值。
* 根据实体完整性约束，一个关系中不允许存在两类元组：
    * 无主码值的元组
    * 主码值相同的元组

### 2. 参照完整性 
* 关系间的引用：在关系模型中实体及实体间的联系都是用关系来描述的，因此可能存在着关系与关系间的引用。
* 若属性（或属性组）F是基本关系R的外码，它与基本关系S的主码KS相对应。则对于R中每个元组在F上的值必须为：
    * 或者取空值（F的每个属性值均为空值）
    * 或者等于S中某个元组的主码值。

### 3. 用户定义完整性

* 用户定义的完整性是针对某一具体关系数据库的约束条件，反映某一具体应用所涉及的数据必须满足的语义要求。

* 关系模型应提供定义和检验这类完整性的机制，以便用统一的系统的方法处理它们，而不要由应用程序承担这一功能。