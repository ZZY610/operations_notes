# 计算机系统组成

## 计算机系统概论
### 冯诺依曼型计算机特点
1. 计算机由运算器，控制器，存储器，输入和输出设备5部分组成
2. 采用存储程序的方式，程序和数据放在同一个存储器中，并以二进制表示。
3. 指令由操作码和地址码组成
4. 指令在存储器中按执行顺序存放，由指令计数器(即程序计数器PC)指明要执行的指令所在的储存单元地址，一般按顺序递增，但可按运算结果或外界条件而改变
5. 机器以运算器为中心，输入输出设备与存储器间的数据传送都通过运算器

### 计算机系统结构
* ==硬件==
    * 结构
        * 主机
            * cpu
                * ALU运算器
                * CU控制器
            * 存储器
                * 主存
                * 辅存
        * I/O
            * 输入设备
            * 输出设备
    * 主要技术指标
        * 机器字长
            * CPU一次能处理的数据位数
        * 存储容量
            * 存储容量＝存储单元个数×存储字长
        * 运算速度
            * 单位时间执行指令的平均条数，MIPS
* ==软件==
    * 系统软件
        * 用来管理整个计算机系统 
            * 语言处理程序
            * 操作系统
            * 服务性程序
            * 数据库管理系统
            * 网络软件
    * 应用软件
        * 按任务需要编制成的各种程序


# 一、存储器及存储系统
## 1. 存储器概述
### 1.1 存储器分类
* 存储器是计算机系统中的记忆设备，用来存放程序和数据。
* 构成存储器的存储介质，目前主要采用半导体器件和磁性材料。
* 存储器中最小的存储单位，就是一个双稳态半导体电路或磁性材料的存储元（位），它可存储一个二进制代码。
* 由若干个存储元组成一个存储单元，然后再由许多存储单元组成一个存储器。

* 根据存储材料的性能及使用方法不同，存储器有各种不同的分类方法： 
    * 按存储介质分 
    * 按存储方式分 
    * 按信息的可保存性分
    * 按在计算机系统中的作用分 

#### 按存储介质分类
* 半导体存储器：用半导体器件组成的存储器。
    * 如RAM、ROM，用作主存。
* 磁表面存储器：用磁性材料做成的存储器。
    * 如磁盘、磁带，用作辅存。
* 激光存储器：信息以刻痕的形式保存在盘上，用激光束照射盘面，靠盘面的不同反射率来读信息。
    * 光盘（只读性光盘CD-ROM、只写一次型光盘WORM等），用作辅存。

#### 按读写方式分类
* 随机存储器（RAM）：
    * 任何存储单元的内容都能被随机存取，且存取时间和存储单元的物理位置**无关**。（主存） 
* 只读存储器（ROM）：
    * 是一种对其内容**只能读不能写入**的存取器，即预先一次写入的存取器。一旦写入长期保存。
    * 写入方式不同：掩模ROM(MROM)，可编程ROM(PROM)，可擦除可编程ROM(EPROM)等
* 串行访问存储器（Sequence Access Storage）：
    * 只能按某种顺序来存取，存取时间和存储单元的物理位置有关。又可分为2种：
        * 顺序存取存储器（SAM）：完全的串行访问，如磁带
        * 直接存取存储器（DAM）： 部分串行访问，如磁盘存储器，介于顺序存取和随机存取之间。

#### 按信息的可保存性分类
* 非永久记忆的存储器：断电后信息即消失的存储器。（主存中的RAM）
* 永久记忆性存储器：断电后仍能保存信息的存储器。 （辅存，ROM）

#### 按在计算机系统中的作用分类
根据存储器在计算机系统中所起的作用，可分为主存储器、辅助存储器、高速缓冲存储器、控制存储器等。
![Img](./FILES/02.%20计算机硬件基础.md/img-20220907140209.png)

### 1.2 存储器的分级结构

* 中央处理器能直接访问的存储器称为**内部存储器**，它包括**高速缓冲存储器cache**和**主存储器**。
* 中央处理器不能直接访问外存储器，外存储器的信息必须调入内存储器后才能为中央处理器进行处理。
* 为了解决对存储器要求容量大，速度快，成本低三者之间的矛盾，目前通常采用多级存储器体系结构，即使用高速缓冲存储器、主存储器和外存储器。
![Img](./FILES/02.%20计算机硬件基础.md/img-20220907140256.png)
![Img](./FILES/02.%20计算机硬件基础.md/img-20220907141309.png)

### 1.3 存储器的用途和特点

| 名称 | 简称 | 用途 | 特点 |
| -- | -- | -- | -- |
| 高速缓冲存储器| Cache | 高速存取指令和数据  | 存取速度快，但存储容量小 |
| 主存储器 | 主/内存，运行内存 | 存放计算机运行期间的大量程序和数据 | 存取速度较快，存储容量不大  |
| 外存储器 | 外存 | 存放系统程序和大型数据文件及数据库 | 存储容量大，位成本低 |

### 1.4 内存与外存的关系及比较
* 外存储器（简称外存或辅存）
    * 存取速度慢
    * 成本低、容量很大
    * 不与CPU直接连接，程序运行时，外存中的程序及相关数据须先传送到内存，然后才能被CPU使用。
    * 属于非易失性存储器(Nonvolatile)，用于长久存放系统中几乎所有的信息

* 内存储器（简称内存或主存）
    * 存取速度快
    * 成本高、容量相对较小
    * 直接与CPU连接，CPU(指令)可以对内存中的指令及数据进行读、写操作
    * 属于易失性存储器(volatile)，用于临时存放正在运行的程序和数据

![Img](./FILES/02.%20计算机硬件基础.md/img-20220907142329.png)

## 2. 主存储器

### 2.1 主存储器的技术指标
主存储器的性能指标主要是存储容量、存取时间、存储周期。

1. **存储容量**   
    * 在一个存储器中可以容纳的主存储器的单元总数通常称为该存储器的存储容量。存储容量通常用字节，符号为B（Byte）作单位。
2. **存取时间**（Memory  Access  Time）
    * 信息存入存储器的操作叫写操作，从存储器取出信息的操作叫读操作，读/写操作统称作“访问”。
    * 从存储器接收到读（或写）申请命令到从存储器读出（或写入）信息所需的时间称为存储器访问时间或称存取时间，用TＡ表示。
3. **存取周期**（Memory  Cycle  Time）
    * 另一个与存取时间指标相近的速度指标是**存取周期**，用$T_M$表示，$T_M$表示存储器**作连续访问操作过程中一次完整存取操作所需的全部时间**。所以存取周期是指连续启动两次独立的存储器操作（如连续两次读操作）所需间隔的最小时间。通常存取周期略大于存取时间，即$T_M$> $T_A$。 存取周期=存取时间+恢复时间

|指标 |	含义 |	表现 |	单位 |
| -- | -- | -- | -- |
|存储容量	|在一个存储器中可以容纳的存储单元总数 	|存储空间的大小 	|字数，字节数 |
|存取时间	|启动到完成一次存储器操作所经历的时间	|主存的速度 	|ns |
|存储周期	|连续启动两次操作所需间隔的最小时间 	|主存的速度 	|ns |
|存储器带宽	|单位时间里存储器所存取的信息量。	|数据传输速率技术指标	|位/秒，字节/秒|

::: tip example
数据总线16位，即一次可存取16位，存取周期100ns，所以存储器带宽是：16×（1×109）/ 100÷8=2×107 Byte/s，即20MB/s.
:::

### 2.2 主存储器的基本结构 

* 它由存储体加上一些外围电路构成。
* 外围电路包括地址译码驱动器、数据寄存器和存储器控制电路等。

### 2.3 存储器基本术语
* 记忆单元 （存储基元 / 存储元 / 位元） （Cell）
    * 具有两种稳态的能够表示二进制数码0和1的物理器件
* 存储单元 / **编址单位**（Addressing Unit） 
    * 主存中具有**相同地址**的那些位构成一个存储单元，也称为一个编址单位
    * 编址单位：一个存储单元的位数。现在都按字节编址，即编址单位为8位。

* 存储体/ 存储矩阵 / 存储阵列（Bank）
    * 所有存储单元构成一个存储阵列
* 编址方式（Addressing Mode） 
    * 对存储体中各存储单元进行编号的方式
        * 按字节编址（基本上现代计算机都按字节编址）
        * 按字编址（早期有机器按字编址）
* 存储器地址寄存器（Memory Address Register - MAR）
    * 用于存放主存单元地址的寄存器
* 存储器数据寄存器（ Memory Data Register-MDR(MBR) ）
    * 用于存放主存单元中的数据的寄存器
* 机器**字长**
    * 运算器中参加运算的寄存器的位数，即：数据通路的宽度。
* **存储字**
    * 存储芯片中的一个读写单位，一般等于芯片的数据线宽度。
    （注：最好存储器按机器字长组织成一个“自然”单位。它的长度一般应等于一个数或指令的位数。但很多机器的数据和指令都是变长的。）
* 传输单位
    * 对主存而言，指一次从主存读出或写入的数的位数，它可以不等于存储字的长度，也可不等于编址单位。
    * 对外存而言，数据通常按块传输，传输单位为块。
   （例如：386/486等，其编址单位为字节，字长为32位，单字位数为16位，但传输单位可以是8/16/24/32位。）
::: tip 字，字节和字长
* 字：计算机进行数据处理时，一次存取加工和传送的数据长度。一个字通常为字节的整数倍（即8的整数倍）。
    * 32位、64位计算机指的是CPU一次可以存取、处理的数据位数。
* 字长：一个字包含的位数。
* 字节：1 Byte = 8 bit

:::


### 2.4 主存储器的基本操作

## 3. 半导体存储器芯片

## 4. 主存储器组织

## 5. 存储保护和校验

# 二、指令系统
## 什么是指令系统
* 一台计算机中所有机器指令的集合，称为这台计算机的指令系统。
* 指令系统是表征一台计算机性能的重要因素，它的格式与功能不仅直接影响到机器的硬件结构，而且也影响到系统软件。
* 指令系统是硬件说明书，是对硬件的抽象，软件通过指令系统驱动硬件。
* 指令系统是桥梁，是平台，是接口，是翻译官。

## 寻址方式
获取操作数的速度由快到慢：立即寻址、寄存器寻址、直接寻址、间接寻址。

## 指令类型

### 数据传送类指令
* 这类指令主要用来实现主存和寄存器之间，或寄存器和寄存器之间，或主存和主存之间的数据传送。
* 主要包括取数指令、存数指令、传送指令、成组传送指令、字节交换指令、清累加器指令、堆栈操作指令等等。
* 传送数据时，数据从源地址传送到目的地址，而源地址中的数据保持不变，因此，实际上是数据拷贝。
### 运算类指令
#### 算术运算指令
* 这类指令主要用于定点或浮点的算术运算，大型机中有向量运算指令，直接对整个向量或矩阵进行求和、求积运算。
* 这类指令包括二进制定点加、减、乘、除指令，浮点加、减、乘、除指令，求反、求补指令，算术移位指令，算术比较指令，十进制加、减运算指令等。

#### 逻辑运算指令
这类指令用以实现对两个数的逻辑运算和位操作功能，主要包括逻辑与（逻辑乘）、或（逻辑加）、非（求反）、异或（按位加）等逻辑操作指令，以及位测试、位清除、位求反等位操作指令。

#### 移位操作指令
* 移位操作指令用以实现将操作数向左移动或向右移动若干位的功能，包括算术移位、逻辑移位和循环移位三种指令。
* 算术移位
    * 左移时，若寄存器中的数为算术操作数，则符号位不动，其它位左移，最低位补零。
    * 右移时，其它位右移，最高位补符号位。
* 逻辑移位
    * 移位时，若寄存器中的操作数为逻辑数，则左移或右移时，所有位一起移位，最低位或最高位补零。
* 循环移位
    * 按是否与“进位”位C一起循环分为小循环(即自身循环)和大循环(即和进位位 C一起循环)两种。
    * 用于实现循环式控制、高低字节互换或与算术、逻辑移位指令一起实现双倍字长或多倍字长的移位。

### 程序控制类指令
* 无条件转移指令与条件转移指令
    * 无条件转移指令不受任何条件限制，直接把程序转移到指令所规定的目的地，从那里开始继续执行程序。
    * 条件转移指令则根据计算机处理结果来控制程序的执行方向，实现程序的分支。首先测试根据处理结果设置的条件码，然后判断所测试的条件是否满足，从而决定是否转移。

* 调用指令与返回指令
    * 编写程序时，常常需要编写一些能够独立完成某一特定功能且经常使用的程序段，在需要时能随时调用，而不必多次重复编写，以便节省存储器空间和简化程序设计。这种程序段就称为子程序或过程。
    * 调用(Call)与返回(Return)是一对配合使用的指令，返回指令从堆栈中取出返回地址，然后继续执行调用指令的下一条指令。

* 陷阱(Trap)与陷阱指令
    * 一旦出现故障，计算机就发出陷阱信号，并暂停当前程序的执行(称为中断)，转入故障处理程序进行相应的故障处理。陷阱实际上是一种意外事故中断。
### 输入输出类指令

* 输入输出指令主要用来启动外围设备，检查测试外围设备的工作状态，并实现外部设备和CPU之间，或外围设备与外围设备之间的信息传送。 

![Img](./FILES/02.%20计算机硬件基础.md/img-20230306141537.png)

## 指令系统的发展
### 复杂指令系统与精简指令系统

* 复杂指令系统(==**CISC**==:Complex Instruction Set Computer)
    * 指令系统复杂
    * 指令周期长
    * 各种指令都能访问存储器
    * Intel 80x86

::: tip CISC的缺陷
日趋庞大的指令系统不但使计算机的研制周期变长，而且难以保证设计的正确性，**难以调试和维护**，并且因指令操作复杂而增加机器周期，从而**降低了系统性能**。
:::

* 精简指令系统(==**RISC**==:Reduced Instruction Set Computer)
    * 简化的指令系统
    * 指令周期短
    * 采用大量==通用寄存器==，以减少访存次数
    * MIPS (Mircoprocessor without Interlocked Pipelining Stages无互锁流水段微处理器)


# 二、中央处理器
## CPU的总体结构
* 冯.诺依曼结构”的结构准则，该结构特点是：
    * 数据信息和控制信息按存储地址存放在存储器中；
    * 计算机由一个程序计数器控制指令的执行。
* 根据该结构准则，计算机分成运算器、控制器、存储器、输入设备和输出设备五大部件。

### CPU的组成和功能
![Img](./FILES/02.%20计算机硬件基础.md/img-20230306134804.png)

* CPU的基本部分由**运算器**和**控制器**两个主要部分组成。 
   ::: tip 什么是数据通路（DataPath）?
    指令执行过程中，数据所经过的路径，包括路径中的部件。它是指令的执行部件。属于运算器的一部分。
   :::
   
  ::: tip 控制器（Control）的功能是什么？
    对指令进行译码，生成指令对应的控制信号，控制数据通路的动作。能对执行部件发出控制信号，是指令的控制部件。  
  :::
  
![Img](./FILES/02.%20计算机硬件基础.md/img-20230306135246.png)

#### 控制器
由==程序计数器==PC、==指令寄存器==IR、==指令译码器==、==时序产生器==和==操作控制器==组成，它是发布命令的“决策机构”，即完成协调和指挥整个计算机系统的操作。

统一指挥并控制计算机各部件协调工作，所依据的是机器指令。

* **程序计数器**(PC，Program Counter)：存放指令的地址（当前指令或者下一条指令地址）。
    * 当指令顺序执行时，由PC+1产生下一条指令的地址；
    * 当遇到转移指令时，转移地址PC作为下一条指令的地址。
* **地址寄存器**(AR，Address Register)：用来保存当前CPU所访问的内存单元的地址。
* **指令寄存器**(IR，Instruction Register)：用来保存当前正在执行的一条指令。
* **指令译码器**(ID，Instruction Decoder)：对指令寄存器中的指令操作码字段进行译码。

#### 运算器
是由==算术逻辑单元==(ALU)、==累加寄存器==、==数据缓冲寄存器==和==状态条件寄存器==、数据通路、多路转换器组成，它是数据加工处理部件。
* 主要负责对信息进行加工处理，运算器从内存储器得到需要加工的数据，对数据进行算术运算和逻辑运算，并将最后的结果返回到内存储器中。

相对控制器而言，运算器接受控制器的命令而进行动作，即运算器所进行的全部操作都是由控制器发出的控制信号来指挥的，所以它是执行部件。

* **算术逻辑单元** (ALU：Arithmetic and Logic Unit)
    * 算术逻辑单元ALU是处理数据的部件，主要负责实现对数据的算术运算和逻辑运算。
* **累加寄存器** (AC：Accumulator)
    * 累加器是暂时存放参加ALU运算的操作数据和结果的部件，是一个通用寄存器。
* 数据缓冲寄存器 ( DR：Data Buffer Register)
* **状态标志寄存器**(state flag register)
    * 状态标志寄存器用来保存由算术指令和逻辑指令运行或测试的结果而建立的各种条件码内容。
    * 如运算结果进位标志(C)，运算结果溢出标志(V)，运算结果为零标志(Z)，运算结果为负标志(N)，等等。
        这些标志位通常分别由1位触发器保存。
    * 除此之外，状态标志寄存器还用来保存中断和系统工作状态等信息，以便CPU和系统能及时了解机器运行状态和程序运行状态。

* 运算器的主要功能：
    * 执行所有的算术运算；
    * 执行所有的逻辑运算，并进行逻辑测试，如零值测试或两个值的比较。

#### CPU的功能
CPU对整个计算机系统的运行是极其重要的，它具有如下五方面的基本功能：
* 指令控制 ：程序的顺序控制称为指令控制。
* 操作控制 ：CPU管理并产生由内存取出的每条指令的操作信号，把各种操作信号送往相应的部件，从而控制这些部件按指令的要求进行动作。
* 时间控制 ：对各种操作实施时间上的定时称为时间控制。
* 数据加工：数据加工就是对数据进行算术运算和逻辑运算处理。  
* 处理异常情况和请求：当计算机出现异常情况，控制器可以中止当前执行的程序，转去执行异常处理或者响应中断和DMA请求并进行相关处理。
